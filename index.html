<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya TV - Premium Live Streaming</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
    
    <style>
        /* ============================== */
        /* Base & Theme */
        /* ============================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        :root {
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --accent-primary: #FACC15;
            --accent-blue: #3B82F6;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --success: #10B981;
            --error: #EF4444;
            --shadow: rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #F59E0B, #FACC15);
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* ============================== */
        /* Layout */
        /* ============================== */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* ============================== */
        /* Channel Sidebar */
        /* ============================== */
        .channels-sidebar {
            width: 380px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--bg-tertiary);
            display: flex;
            flex-direction: column;
            position: absolute;
            height: 100%;
            z-index: 100;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 5px 0 20px var(--shadow);
        }
        
        .channels-sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 24px 20px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 3px solid var(--accent-primary);
        }

        .app-logo {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--bg-primary);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo::before {
            content: 'üì∫';
            font-size: 1.2em;
        }

        .channel-count {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--bg-primary);
            background: rgba(255,255,255,0.9);
            padding: 4px 12px;
            border-radius: 20px;
            margin-left: auto;
        }

        .sidebar-search-container {
            padding: 20px;
            border-bottom: 1px solid var(--bg-tertiary);
            position: relative;
        }

        #channel-search {
            width: 100%;
            padding: 15px 20px 15px 48px;
            font-size: 1.05em;
            border: 2px solid var(--bg-tertiary);
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.3s;
        }
        
        #channel-search:focus {
            border-color: var(--accent-primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.2);
            background: var(--bg-primary);
        }

        .search-icon {
            position: absolute;
            left: 35px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.2em;
        }
        
        .channel-list {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .channel-list::-webkit-scrollbar {
            width: 8px;
        }

        .channel-list::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .channel-list::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        .channel-category {
            padding: 15px 20px;
            color: var(--accent-primary);
            font-weight: 700;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(250, 204, 21, 0.1);
            border-bottom: 1px solid var(--bg-tertiary);
        }
        
        .channel-card {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-tertiary);
            margin: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            gap: 15px;
        }
        
        .channel-card:hover,
        .channel-card:focus {
            transform: translateX(5px);
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 8px 24px var(--shadow);
            outline: none;
        }
        
        .channel-card.active {
            border-color: var(--accent-blue);
            background: linear-gradient(135deg, var(--bg-tertiary), rgba(59, 130, 246, 0.1));
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { border-color: var(--accent-blue); }
            50% { border-color: rgba(59, 130, 246, 0.6); }
        }

        .channel-card.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background: var(--accent-blue);
            border-radius: 0 4px 4px 0;
        }

        .channel-number {
            font-weight: 700;
            color: var(--accent-primary);
            min-width: 24px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .channel-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 4px;
            flex-shrink: 0;
        }
        
        .channel-info {
            flex: 1;
            min-width: 0;
        }
        
        .channel-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .channel-resolution {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            display: inline-block;
            animation: pulse 1.5s infinite;
        }

        .channel-card.active .live-indicator {
            animation: pulse 0.5s infinite;
        }

        .favorite-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
            border-radius: 4px;
        }

        .favorite-btn:hover {
            color: var(--accent-primary);
            transform: scale(1.2);
        }

        .favorite-btn.favorited {
            color: var(--accent-primary);
        }
        
        /* ============================== */
        /* Player Area */
        /* ============================== */
        .player-area {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .splash-screen {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            animation: fadeIn 0.5s ease;
        }

        .splash-logo {
            font-size: 4em;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .splash-tagline {
            font-size: 1.3em;
            color: var(--text-secondary);
            margin-bottom: 40px;
            text-align: center;
            max-width: 500px;
            line-height: 1.6;
        }

        .splash-features {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }

        .feature {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .feature-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .feature-text {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .splash-cta {
            background: var(--gradient-primary);
            color: var(--bg-primary);
            padding: 18px 40px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1em;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(250, 204, 21, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .splash-cta:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 32px rgba(250, 204, 21, 0.6);
        }

        .splash-cta::after {
            content: '‚ñ∂';
            font-size: 1.2em;
        }
        
        .shaka-video-container {
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
        }

        .shaka-video-container.active {
            display: block;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        :fullscreen video,
        :-webkit-full-screen video {
            object-fit: cover !important;
        }
        
        .player-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .player-controls:hover {
            opacity: 1;
        }

        .player-controls > * {
            pointer-events: auto;
        }
        
        .current-channel-info {
            color: white;
            font-weight: 700;
            font-size: 1.2em;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            margin-left: 20px;
        }

        #stream-status {
            font-size: 0.75em;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-live {
            background: var(--success);
            color: #fff;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
        }

        .status-live::before {
            content: '‚óè';
            font-size: 0.8em;
            animation: pulse 1.5s infinite;
        }

        .status-offline {
            background: var(--error);
            color: #fff;
        }
        
        .player-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover,
        .action-btn:focus {
            background: rgba(255,255,255,0.25);
            border-color: var(--accent-primary);
            transform: scale(1.1);
            outline: none;
        }

        .toggle-sidebar-btn {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-sidebar-btn:hover,
        .toggle-sidebar-btn:focus {
            background: rgba(255,255,255,0.25);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            outline: none;
        }

        .toggle-sidebar-btn::before {
            content: 'üì∫';
        }
        
        /* ============================== */
        /* Ad Dialog */
        /* ============================== */
        .ad-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.97);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .ad-overlay.active {
            display: flex;
        }

        .ad-dialog {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 50px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            border: 3px solid var(--accent-primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: slideUp 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .ad-header {
            margin-bottom: 30px;
        }

        .ad-logo {
            font-size: 3.5em;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .ad-logo::before {
            content: 'üì∫';
        }

        .ad-channel-name {
            font-size: 1.6em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .ad-message {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .ad-notice {
            font-size: 0.9em;
            color: var(--accent-primary);
            margin-bottom: 30px;
            font-weight: 600;
            padding: 10px;
            background: rgba(250, 204, 21, 0.1);
            border-radius: 8px;
        }

        .ad-content {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
        }

        .ad-spinner {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent-primary);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ad-timer {
            font-size: 1.5em;
            color: var(--accent-primary);
            font-weight: 800;
            margin: 20px 0;
        }

        .ad-progress {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .ad-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 1s linear;
        }
        
        /* ============================== */
        /* Loading & Error States */
        /* ============================== */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent-primary);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .error-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            display: none;
        }

        .error-container.active {
            display: block;
        }
        
        .error-message {
            background: linear-gradient(135deg, #450A0A, #7F1D1D);
            color: #FECACA;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 450px;
            border: 2px solid var(--error);
            box-shadow: 0 20px 60px rgba(239, 68, 68, 0.3);
        }

        .error-message h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .error-message h3::before {
            content: '‚ö†Ô∏è';
        }
        
        .refresh-btn {
            background: var(--gradient-primary);
            color: var(--bg-primary);
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px auto 0;
        }

        .refresh-btn::before {
            content: '‚ü≥';
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(250, 204, 21, 0.4);
        }

        /* ============================== */
        /* Notification System */
        /* ============================== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 350px;
        }

        .notification {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent-primary);
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 20px var(--shadow);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-icon {
            font-size: 1.5em;
            color: var(--accent-primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            border-radius: 4px;
        }

        .notification-close:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.1);
        }

        /* ============================== */
        /* Responsive */
        /* ============================== */
        @media (min-width: 769px) {
            .channels-sidebar {
                position: relative;
                transform: translateX(0);
                box-shadow: none;
            }

            .toggle-sidebar-btn {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .channels-sidebar {
                width: 100%;
                max-width: 380px;
            }

            .splash-logo {
                font-size: 2.5em;
            }

            .splash-tagline {
                font-size: 1.1em;
                padding: 0 20px;
            }

            .splash-features {
                flex-direction: column;
                gap: 20px;
            }

            .feature {
                flex-direction: row;
                gap: 15px;
            }

            .ad-dialog {
                padding: 30px 20px;
            }

            .current-channel-info {
                font-size: 1em;
            }

            .player-controls {
                padding: 15px;
            }

            .toggle-sidebar-btn span {
                display: none;
            }

            .toggle-sidebar-btn {
                padding: 10px 15px;
            }

            .toggle-sidebar-btn::before {
                content: 'üì∫';
                font-size: 1.2em;
            }

            .action-btn {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .channel-card {
                margin: 10px 15px;
                padding: 12px 15px;
            }

            .channel-logo {
                width: 40px;
                height: 40px;
            }

            .channel-title {
                font-size: 0.9em;
            }
        }

        /* ============================== */
        /* Accessibility */
        /* ============================== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="main-content">
            <!-- Channel Sidebar -->
            <div class="channels-sidebar" id="channels-sidebar">
                <div class="sidebar-header">
                    <div class="app-logo">Maya TV</div>
                    <div class="channel-count" id="channel-count">0 Channels</div>
                </div>

                <div class="sidebar-search-container">
                    <div class="search-icon">üîç</div>
                    <input type="search" id="channel-search" placeholder="Search channels..." aria-label="Search channels">
                </div>
                
                <div class="channel-list" id="channel-list">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading channels...</p>
                    </div>
                </div>
            </div>
            
            <!-- Player Area -->
            <div class="player-area" id="player-area">
                <!-- Splash Screen (shown initially) -->
                <div class="splash-screen" id="splash-screen">
                    <div class="splash-logo">Maya TV</div>
                    <div class="splash-tagline">Experience premium live streaming with crystal-clear HD quality and seamless playback across all your devices</div>
                    
                    <div class="splash-features">
                        <div class="feature">
                            <div class="feature-icon">üì°</div>
                            <div class="feature-text">Live TV</div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">‚ö°</div>
                            <div class="feature-text">Low Latency</div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">üì±</div>
                            <div class="feature-text">Multi-Device</div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">üîí</div>
                            <div class="feature-text">Secure</div>
                        </div>
                    </div>
                    
                    <button class="splash-cta" id="start-watching">
                        <span>Start Watching Now</span>
                    </button>
                </div>

                <!-- Player Controls -->
                <div class="player-controls">
                    <button class="toggle-sidebar-btn" id="toggle-sidebar">
                        <span>Channels</span>
                    </button>
                    <div class="current-channel-info">
                        <span id="current-channel">Select a channel</span>
                        <span id="stream-status" class="status-offline">Offline</span>
                    </div>
                    <div class="player-actions">
                        <button class="action-btn" id="prev-channel" title="Previous Channel">‚óÄ</button>
                        <button class="action-btn" id="next-channel" title="Next Channel">‚ñ∂</button>
                        <button class="action-btn" id="fullscreen-btn" title="Fullscreen">‚õ∂</button>
                    </div>
                </div>
                
                <!-- Video Player -->
                <div class="shaka-video-container" data-shaka-player>
                    <video autoplay playsinline preload="metadata" aria-label="Video Player"></video>
                </div>
            </div>
        </div>

        <!-- Ad Dialog Overlay -->
        <div class="ad-overlay" id="ad-overlay">
            <div class="ad-dialog">
                <div class="ad-header">
                    <div class="ad-logo">Maya TV</div>
                    <div class="ad-channel-name" id="ad-channel-name">Channel Name</div>
                    <div class="ad-message">
                        Your streaming experience is supported by occasional ads
                    </div>
                    <div class="ad-notice">
                        üîí Ads help maintain our premium servers and ensure smooth streaming for all users
                    </div>
                </div>
                
                <div class="ad-content">
                    <div class="ad-spinner"></div>
                    <div class="ad-timer" id="ad-timer">5</div>
                    <div class="ad-progress">
                        <div class="ad-progress-bar" id="ad-progress-bar"></div>
                    </div>
                    <div class="ad-message">
                        Preparing your stream...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Error Container -->
        <div class="error-container" id="error-container">
            <div class="error-message">
                <h3>Connection Error</h3>
                <p id="error-text">Could not retrieve channel list.</p>
                <button class="refresh-btn" id="refresh-btn">Try Again</button>
            </div>
        </div>

        <!-- Notification Container -->
        <div class="notification-container" id="notification-container"></div>
    </div>

    <script>
        // ==============================
        // Maya TV - Main Application Script
        // ==============================

        // ============================== 
        // Configuration & Constants
        // ==============================
        const CONFIG = {
            API_URL: "https://static-crane-seeutech-17dd4df3.koyeb.app/api/channels",
            AD_INTERVAL: 15 * 60 * 1000, // 15 minutes in milliseconds
            AD_DURATION: 5000, // 5 seconds (simulated ad duration)
            DEFAULT_HEADERS: {
                'Referer': 'https://www.jiotv.com/',
                'User-Agent': "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6"
            },
            PLAYER_CONFIG: {
                streaming: {
                    lowLatencyMode: true,
                    bufferingGoal: 10,
                    rebufferingGoal: 2,
                    bufferBehind: 10,
                    retryParameters: {
                        timeout: 10000,
                        maxAttempts: 3,
                        baseDelay: 1000,
                        backoffFactor: 2
                    }
                },
                manifest: {
                    retryParameters: {
                        timeout: 8000,
                        maxAttempts: 2
                    }
                },
                abr: {
                    enabled: true
                }
            },
            CHANNELS_PER_PAGE: 20
        };

        // ==============================
        // State Management
        // ==============================
        const AppState = {
            allChannels: [],
            favoriteChannels: JSON.parse(localStorage.getItem('mayaTV_favorites') || '[]'),
            currentChannel: null,
            currentSearchTerm: '',
            player: null,
            video: null,
            ui: null,
            adTimer: null,
            lastAdTime: null,
            isAdShowing: false,
            categorizedChannels: {},
            isPlaying: false,
            currentPage: 1
        };

        // ==============================
        // DOM Elements Cache
        // ==============================
        const DOM = {
            channelSearchInput: null,
            channelList: null,
            errorContainer: null,
            errorText: null,
            channelsSidebar: null,
            toggleSidebarBtn: null,
            currentChannelElement: null,
            streamStatusIndicator: null,
            splashScreen: null,
            startWatchingBtn: null,
            playerArea: null,
            videoContainer: null,
            adOverlay: null,
            adChannelName: null,
            adTimer: null,
            adProgressBar: null,
            refreshBtn: null,
            notificationContainer: null,
            prevChannelBtn: null,
            nextChannelBtn: null,
            fullscreenBtn: null,
            channelCount: null
        };

        // ==============================
        // Initialization
        // ==============================
        function cacheDOMElements() {
            DOM.channelSearchInput = document.getElementById('channel-search');
            DOM.channelList = document.getElementById('channel-list');
            DOM.errorContainer = document.getElementById('error-container');
            DOM.errorText = document.getElementById('error-text');
            DOM.channelsSidebar = document.getElementById('channels-sidebar');
            DOM.toggleSidebarBtn = document.getElementById('toggle-sidebar');
            DOM.currentChannelElement = document.getElementById('current-channel');
            DOM.streamStatusIndicator = document.getElementById('stream-status');
            DOM.splashScreen = document.getElementById('splash-screen');
            DOM.startWatchingBtn = document.getElementById('start-watching');
            DOM.playerArea = document.getElementById('player-area');
            DOM.videoContainer = document.querySelector('.shaka-video-container');
            DOM.adOverlay = document.getElementById('ad-overlay');
            DOM.adChannelName = document.getElementById('ad-channel-name');
            DOM.adTimer = document.getElementById('ad-timer');
            DOM.adProgressBar = document.getElementById('ad-progress-bar');
            DOM.refreshBtn = document.getElementById('refresh-btn');
            DOM.notificationContainer = document.getElementById('notification-container');
            DOM.prevChannelBtn = document.getElementById('prev-channel');
            DOM.nextChannelBtn = document.getElementById('next-channel');
            DOM.fullscreenBtn = document.getElementById('fullscreen-btn');
            DOM.channelCount = document.getElementById('channel-count');
        }

        async function initPlayer() {
            shaka.polyfill.installAll();
            
            if (!shaka.Player.isBrowserSupported()) {
                showError('Your browser does not support video playback. Please try a modern browser like Chrome or Firefox.');
                return false;
            }
            
            AppState.video = document.querySelector('video');
            AppState.player = new shaka.Player();
            await AppState.player.attach(AppState.video);
            
            const container = DOM.videoContainer;
            AppState.ui = new shaka.ui.Overlay(AppState.player, container, AppState.video);
            
            AppState.ui.configure({
                controlPanelElements: [
                    'play_pause', 'time_and_duration', 'mute', 'volume',
                    'spacer', 'audio', 'quality', 'fullscreen'
                ],
                volumeBarColors: { base: '#3B82F6', level: '#3B82F6' },
                seekBarColors: { base: '#FACC15', buffered: '#FACC15', played: '#FACC15' }
            });
            
            AppState.player.configure(CONFIG.PLAYER_CONFIG);
            
            // Event listeners
            AppState.player.addEventListener('error', (event) => {
                console.error('Player error:', event.detail);
                updateStreamStatus('offline');
                showNotification('Stream Error', 'Could not load the stream. Trying alternative...', 'error');
            });

            AppState.video.addEventListener('loadeddata', () => {
                updateStreamStatus('live');
                AppState.isPlaying = true;
                showNotification('Stream Started', 'Enjoy your viewing experience!', 'success');
            });

            AppState.video.addEventListener('pause', () => {
                AppState.isPlaying = false;
            });

            AppState.video.addEventListener('play', () => {
                AppState.isPlaying = true;
            });
            
            AppState.video.volume = 0.8;
            
            return true;
        }

        async function initApp() {
            cacheDOMElements();
            
            // Show splash screen with animation
            setTimeout(() => {
                DOM.splashScreen.style.opacity = '1';
            }, 100);
            
            const playerReady = await initPlayer();
            if (!playerReady) return;

            await loadChannels();
            setupEventListeners();
            
            // Set initial sidebar state based on screen size
            if (window.innerWidth <= 768) {
                DOM.channelsSidebar.classList.remove('open');
            } else {
                DOM.channelsSidebar.classList.add('open');
            }

            // Initialize last ad time
            AppState.lastAdTime = Date.now();

            // Show welcome notification
            setTimeout(() => {
                showNotification('Welcome to Maya TV', 'Select a channel to start streaming!', 'info');
            }, 2000);
        }

        // ==============================
        // Event Listeners Setup
        // ==============================
        function setupEventListeners() {
            // Search
            DOM.channelSearchInput.addEventListener('input', debounce((e) => {
                AppState.currentSearchTerm = e.target.value.toLowerCase();
                renderChannels();
            }, 300));
            
            // Sidebar toggle
            DOM.toggleSidebarBtn.addEventListener('click', toggleSidebar);
            
            // Splash screen
            DOM.startWatchingBtn.addEventListener('click', () => {
                DOM.splashScreen.style.opacity = '0';
                setTimeout(() => {
                    DOM.splashScreen.style.display = 'none';
                    DOM.channelsSidebar.classList.add('open');
                    DOM.channelSearchInput.focus();
                    showNotification('Get Started', 'Browse channels and select one to start watching!', 'info');
                }, 500);
            });
            
            // Error refresh
            DOM.refreshBtn.addEventListener('click', () => {
                hideError();
                loadChannels();
            });
            
            // Channel navigation
            DOM.prevChannelBtn.addEventListener('click', () => changeChannelByDelta(-1));
            DOM.nextChannelBtn.addEventListener('click', () => changeChannelByDelta(1));
            
            // Fullscreen
            DOM.fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Fullscreen changes
            document.addEventListener('fullscreenchange', updateFullscreenButton);
            document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
            
            // Window resize
            window.addEventListener('resize', debounce(() => {
                if (window.innerWidth <= 768 && DOM.channelsSidebar.classList.contains('open')) {
                    DOM.channelsSidebar.classList.remove('open');
                }
            }, 250));
            
            // Auto-hide controls
            DOM.playerArea.addEventListener('mousemove', showPlayerControls);
            DOM.playerArea.addEventListener('mouseleave', hidePlayerControls);
            
            // Click outside to close sidebar on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && 
                    DOM.channelsSidebar.classList.contains('open') &&
                    !DOM.channelsSidebar.contains(e.target) &&
                    e.target !== DOM.toggleSidebarBtn) {
                    DOM.channelsSidebar.classList.remove('open');
                }
            });
        }

        // ==============================
        // Utility Functions
        // ==============================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">${getNotificationIcon(type)}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" aria-label="Close notification">√ó</button>
            `;
            
            DOM.notificationContainer.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
            
            // Close button
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            });
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'warning': return '‚ö†Ô∏è';
                case 'info': 
                default: return '‚ÑπÔ∏è';
            }
        }

        // ==============================
        // API Functions
        // ==============================
        async function loadChannels() {
            hideError();
            showLoading();
            
            try {
                const response = await fetch(CONFIG.API_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    AppState.allChannels = data.data.map((channel, index) => ({
                        ...channel,
                        number: index + 1,
                        category: channel.category || 'General',
                        isFavorite: AppState.favoriteChannels.includes(channel.id)
                    }));
                    
                    categorizeChannels();
                    renderChannels();
                    updateChannelCount();
                    
                    showNotification('Channels Loaded', `${AppState.allChannels.length} channels available`, 'success');
                } else {
                    throw new Error('Invalid API response format');
                }
                
            } catch (error) {
                console.error('Failed to load channels:', error);
                showError(`Failed to load channels: ${error.message}`);
                showNotification('Connection Error', 'Could not load channels. Please check your connection.', 'error');
            }
        }

        function categorizeChannels() {
            AppState.categorizedChannels = {};
            
            AppState.allChannels.forEach(channel => {
                if (!AppState.categorizedChannels[channel.category]) {
                    AppState.categorizedChannels[channel.category] = [];
                }
                AppState.categorizedChannels[channel.category].push(channel);
            });
        }

        function updateChannelCount() {
            DOM.channelCount.textContent = `${AppState.allChannels.length} Channels`;
        }

        // ==============================
        // UI Rendering
        // ==============================
        function showLoading() {
            DOM.channelList.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading channels...</p>
                </div>
            `;
        }

        function showError(message) {
            DOM.errorText.textContent = message;
            DOM.errorContainer.classList.add('active');
        }

        function hideError() {
            DOM.errorContainer.classList.remove('active');
        }

        function updateStreamStatus(status) {
            DOM.streamStatusIndicator.textContent = status.toUpperCase();
            DOM.streamStatusIndicator.classList.remove('status-live', 'status-offline');
            DOM.streamStatusIndicator.classList.add(`status-${status}`);
        }

        function renderChannels() {
            if (AppState.allChannels.length === 0) return;
            
            const filteredChannels = AppState.currentSearchTerm.length > 0
                ? AppState.allChannels.filter(channel => 
                    channel.title.toLowerCase().includes(AppState.currentSearchTerm) ||
                    channel.category.toLowerCase().includes(AppState.currentSearchTerm))
                : AppState.allChannels;
            
            if (filteredChannels.length === 0) {
                DOM.channelList.innerHTML = `
                    <div class="loading">
                        <p>No channels found matching "${AppState.currentSearchTerm}"</p>
                        <button class="refresh-btn" onclick="document.getElementById('channel-search').value=''; renderChannels();" style="margin-top: 20px;">
                            Clear Search
                        </button>
                    </div>
                `;
                return;
            }
            
            // Group by category if not searching
            if (AppState.currentSearchTerm.length === 0) {
                renderCategorizedChannels(filteredChannels);
            } else {
                renderSearchResults(filteredChannels);
            }
        }

        function renderCategorizedChannels(channels) {
            DOM.channelList.innerHTML = '';
            
            Object.keys(AppState.categorizedChannels).forEach(category => {
                const categoryChannels = AppState.categorizedChannels[category];
                const filteredCategoryChannels = categoryChannels.filter(channel => 
                    channels.some(c => c.id === channel.id)
                );
                
                if (filteredCategoryChannels.length > 0) {
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'channel-category';
                    categoryElement.textContent = `${category} (${filteredCategoryChannels.length})`;
                    DOM.channelList.appendChild(categoryElement);
                    
                    filteredCategoryChannels.forEach(channel => {
                        DOM.channelList.appendChild(createChannelCard(channel));
                    });
                }
            });
        }

        function renderSearchResults(channels) {
            DOM.channelList.innerHTML = '';
            
            const resultsCount = document.createElement('div');
            resultsCount.className = 'channel-category';
            resultsCount.textContent = `Search Results (${channels.length})`;
            DOM.channelList.appendChild(resultsCount);
            
            channels.forEach(channel => {
                DOM.channelList.appendChild(createChannelCard(channel));
            });
        }

        function createChannelCard(channel) {
            const card = document.createElement('div');
            card.className = 'channel-card';
            card.tabIndex = 0;
            card.dataset.channelId = channel.id;

            const isActive = AppState.currentChannel && AppState.currentChannel.id === channel.id;
            if (isActive) {
                card.classList.add('active');
            }
            
            const placeholderUrl = `https://placehold.co/100x50/334155/F8FAFC?text=${encodeURIComponent(channel.title.substring(0, 15))}`;
            
            card.innerHTML = `
                <div class="channel-number">${channel.number}</div>
                <img src="${channel.logo || placeholderUrl}" 
                     alt="${channel.title}" 
                     class="channel-logo"
                     onerror="this.src='${placeholderUrl}'">
                <div class="channel-info">
                    <div class="channel-title">${channel.title}</div>
                    <div class="channel-resolution">
                        <span class="live-indicator"></span>
                        <span>${channel.category} ‚Ä¢ HD</span>
                    </div>
                </div>
                <button class="favorite-btn ${channel.isFavorite ? 'favorited' : ''}" 
                        aria-label="${channel.isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
                    ${channel.isFavorite ? '‚òÖ' : '‚òÜ'}
                </button>
            `;
            
            const playHandler = (e) => {
                e.preventDefault();
                playChannel(channel);
            };
            
            card.addEventListener('click', playHandler);
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    playHandler(e);
                }
            });
            
            // Favorite button
            const favoriteBtn = card.querySelector('.favorite-btn');
            favoriteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(channel);
            });
            
            return card;
        }

        function toggleFavorite(channel) {
            const index = AppState.favoriteChannels.indexOf(channel.id);
            if (index === -1) {
                AppState.favoriteChannels.push(channel.id);
                channel.isFavorite = true;
                showNotification('Added to Favorites', `${channel.title} added to favorites`, 'success');
            } else {
                AppState.favoriteChannels.splice(index, 1);
                channel.isFavorite = false;
                showNotification('Removed from Favorites', `${channel.title} removed from favorites`, 'info');
            }
            
            localStorage.setItem('mayaTV_favorites', JSON.stringify(AppState.favoriteChannels));
            renderChannels();
        }

        function toggleSidebar() {
            DOM.channelsSidebar.classList.toggle('open');
            if (DOM.channelsSidebar.classList.contains('open')) {
                const activeCard = DOM.channelList.querySelector('.channel-card.active');
                if (activeCard) {
                    activeCard.focus();
                } else {
                    DOM.channelSearchInput.focus();
                }
            }
        }

        // ==============================
        // Ad System
        // ==============================
        function showAdDialog(channelName) {
            if (AppState.isAdShowing) return;
            
            AppState.isAdShowing = true;
            DOM.adChannelName.textContent = channelName;
            DOM.adOverlay.classList.add('active');
            
            let countdown = Math.ceil(CONFIG.AD_DURATION / 1000);
            DOM.adTimer.textContent = countdown;
            DOM.adProgressBar.style.width = '0%';
            
            const startTime = Date.now();
            const totalTime = CONFIG.AD_DURATION;
            
            const updateProgress = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / totalTime) * 100, 100);
                DOM.adProgressBar.style.width = `${progress}%`;
            };
            
            const countdownInterval = setInterval(() => {
                countdown--;
                updateProgress();
                
                if (countdown > 0) {
                    DOM.adTimer.textContent = countdown;
                } else {
                    clearInterval(countdownInterval);
                    hideAdDialog();
                }
            }, 1000);
            
            // Update progress every 100ms for smoother animation
            const progressInterval = setInterval(updateProgress, 100);
            
            // Clean up intervals when ad is hidden
            setTimeout(() => {
                clearInterval(countdownInterval);
                clearInterval(progressInterval);
            }, CONFIG.AD_DURATION);
        }

        function hideAdDialog() {
            DOM.adOverlay.classList.remove('active');
            AppState.isAdShowing = false;
            AppState.lastAdTime = Date.now();
            
            showNotification('Stream Resuming', 'Your selected channel is now loading...', 'info');
        }

        function scheduleNextAd() {
            if (AppState.adTimer) {
                clearTimeout(AppState.adTimer);
            }
            
            AppState.adTimer = setTimeout(() => {
                if (AppState.currentChannel && AppState.video && AppState.isPlaying) {
                    showNotification('Advertisement', 'Brief ad to support our streaming service', 'info');
                    setTimeout(() => {
                        showAdDialog(AppState.currentChannel.title);
                    }, 2000);
                }
                scheduleNextAd();
            }, CONFIG.AD_INTERVAL);
        }

        // ==============================
        // Playback Functions
        // ==============================
        async function playChannel(channel) {
            if (!AppState.player) return;
            
            // Update UI
            document.querySelectorAll('.channel-card').forEach(card => {
                card.classList.remove('active');
            });
            
            AppState.currentChannel = channel;
            DOM.currentChannelElement.textContent = channel.title;
            updateStreamStatus('loading');
            
            // Highlight selected channel
            const currentCard = DOM.channelList.querySelector(`[data-channel-id="${channel.id}"]`);
            if (currentCard) {
                currentCard.classList.add('active');
                currentCard.focus();
            }
            
            // Hide splash, show player
            if (DOM.splashScreen.style.display !== 'none') {
                DOM.splashScreen.style.display = 'none';
            }
            DOM.videoContainer.classList.add('active');
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                DOM.channelsSidebar.classList.remove('open');
            }
            
            // Show initial ad before stream starts
            showAdDialog(channel.title);
            
            // Wait for ad to finish, then load stream
            setTimeout(async () => {
                try {
                    await AppState.player.unload();
                    AppState.player.configure(CONFIG.PLAYER_CONFIG);
                    
                    // Configure DRM if available
                    if (channel.key && channel.key.includes(':')) {
                        const [keyId, keyValue] = channel.key.split(':');
                        AppState.player.configure({
                            drm: {
                                clearKeys: {
                                    [keyId]: keyValue
                                }
                            }
                        });
                    }
                    
                    // Configure request filters
                    AppState.player.getNetworkingEngine().clearAllRequestFilters();
                    AppState.player.getNetworkingEngine().registerRequestFilter((type, request) => {
                        request.headers['Referer'] = CONFIG.DEFAULT_HEADERS.Referer;
                        request.headers['User-Agent'] = CONFIG.DEFAULT_HEADERS['User-Agent'];
                        
                        if (channel.cookie) {
                            request.headers['Cookie'] = channel.cookie;
                        }
                        
                        if (channel.cookie && 
                            (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
                             type === shaka.net.NetworkingEngine.RequestType.SEGMENT)) {
                            const hdneaMatch = channel.cookie.match(/__hdnea__=[^;]+/);
                            if (hdneaMatch && !request.uris[0].includes('__hdnea__=')) {
                                const separator = request.uris[0].includes('?') ? '&' : '?';
                                request.uris[0] += separator + hdneaMatch[0];
                            }
                        }
                    });
                    
                    await AppState.player.load(channel.url);
                    await attemptAutoplay();
                    
                    // Schedule recurring ads (every 15 minutes)
                    scheduleNextAd();
                    
                    showNotification('Stream Ready', `Now playing: ${channel.title}`, 'success');
                    
                } catch (error) {
                    console.error('Playback error:', error);
                    updateStreamStatus('offline');
                    showNotification('Playback Error', 'Could not load the stream. Please try another channel.', 'error');
                }
            }, CONFIG.AD_DURATION);
        }

        async function attemptAutoplay() {
            if (!AppState.video) return false;
            
            try {
                AppState.video.muted = false;
                await AppState.video.play();
                return true;
            } catch (error) {
                try {
                    AppState.video.muted = true;
                    await AppState.video.play();
                    return true;
                } catch (mutedError) {
                    console.log('Autoplay failed:', mutedError.message);
                    showNotification('Autoplay Blocked', 'Click the play button to start the stream', 'warning');
                    return false;
                }
            }
        }

        // ==============================
        // Channel Navigation
        // ==============================
        function changeChannelByDelta(delta) {
            if (AppState.allChannels.length === 0) return;
            
            let currentId = AppState.currentChannel ? AppState.currentChannel.id : null;
            let currentIndex = currentId ? AppState.allChannels.findIndex(c => c.id === currentId) : -1;

            if (currentIndex === -1) {
                currentIndex = delta > 0 ? -1 : 0;
            }
            
            let nextIndex = currentIndex + delta;
            
            if (nextIndex >= AppState.allChannels.length) {
                nextIndex = 0;
            } else if (nextIndex < 0) {
                nextIndex = AppState.allChannels.length - 1;
            }
            
            playChannel(AppState.allChannels[nextIndex]);
        }

        // ==============================
        // Fullscreen Functions
        // ==============================
        function toggleFullscreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (DOM.playerArea.requestFullscreen) {
                    DOM.playerArea.requestFullscreen();
                } else if (DOM.playerArea.webkitRequestFullscreen) {
                    DOM.playerArea.webkitRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
            }
        }

        function updateFullscreenButton() {
            const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement);
            DOM.fullscreenBtn.textContent = isFullscreen ? '‚õ∂' : '‚õ∂';
            DOM.fullscreenBtn.title = isFullscreen ? 'Exit Fullscreen' : 'Fullscreen';
        }

        // ==============================
        // Player Controls Visibility
        // ==============================
        let controlsTimeout;
        function showPlayerControls() {
            DOM.playerControls = DOM.playerControls || document.querySelector('.player-controls');
            if (DOM.playerControls) {
                DOM.playerControls.style.opacity = '1';
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(hidePlayerControls, 3000);
            }
        }

        function hidePlayerControls() {
            DOM.playerControls = DOM.playerControls || document.querySelector('.player-controls');
            if (DOM.playerControls && !DOM.playerControls.matches(':hover')) {
                DOM.playerControls.style.opacity = '0';
            }
        }

        // ==============================
        // Keyboard Navigation
        // ==============================
        function handleKeyboardNavigation(e) {
            if (document.activeElement === DOM.channelSearchInput) {
                return;
            }
            
            const isSidebarOpen = DOM.channelsSidebar.classList.contains('open');
            const focusableChannels = Array.from(DOM.channelList.querySelectorAll('.channel-card'));
            let currentFocusIndex = focusableChannels.findIndex(el => el === document.activeElement);

            switch (e.key) {
                case 'ArrowUp':
                case 'ArrowDown':
                    if (isSidebarOpen && focusableChannels.length > 0) {
                        e.preventDefault();
                        const delta = e.key === 'ArrowDown' ? 1 : -1;
                        let nextIndex = currentFocusIndex + delta;
                        
                        if (nextIndex >= focusableChannels.length) {
                            nextIndex = 0;
                        } else if (nextIndex < 0) {
                            nextIndex = focusableChannels.length - 1;
                        }
                        
                        focusableChannels[nextIndex].focus();
                        focusableChannels[nextIndex].scrollIntoView({ block: "nearest", behavior: "smooth" });
                    }
                    break;

                case ' ':
                case 'Enter':
                    if (document.activeElement.classList.contains('channel-card')) {
                        e.preventDefault();
                        const channelId = document.activeElement.dataset.channelId;
                        const channel = AppState.allChannels.find(c => c.id === channelId);
                        if (channel) {
                            playChannel(channel);
                        }
                    }
                    break;
                
                case 'Escape':
                    e.preventDefault();
                    if (document.fullscreenElement || document.webkitFullscreenElement) {
                        toggleFullscreen();
                    } else if (isSidebarOpen && window.innerWidth <= 768) {
                        DOM.channelsSidebar.classList.remove('open');
                        DOM.toggleSidebarBtn.focus();
                    }
                    break;
                
                case 'ArrowLeft':
                    e.preventDefault();
                    changeChannelByDelta(-1);
                    break;
                
                case 'ArrowRight':
                    e.preventDefault();
                    changeChannelByDelta(1);
                    break;

                case 'f':
                case 'F':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        DOM.channelSearchInput.focus();
                    }
                    break;

                case '/':
                    e.preventDefault();
                    DOM.channelSearchInput.focus();
                    break;
            }
        }

        // ==============================
        // Start Application
        // ==============================
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
